#!/usr/bin/env rua
-- see how well I can run langfix in the parent and the child
local Lua = require 'lua'
local lua = Lua()

-- TODO should I be exposing this as a global?
--local luaToFixed = require 'langfix.env'().luaToFixed
local luaToFixed = langfix.luaToFixed

lua.load = |:, data, source| do
	return Lua.load(self, luaToFixed(data), source)
end

-- make sure langfix works in parent ...
local f = ||do
	local g = lua[[
-- make sure langfix works in child ...
local g = ||do
	return "hello from langfix lua child State"
end
return g
]]

	return g()
end
assert.eq(f(), "hello from langfix lua child State")
print'done'
